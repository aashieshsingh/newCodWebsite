---
import { Image } from "astro:assets";

// Load images per category
const images = [
  { category: "Meeting", files: Object.values(import.meta.glob("/src/assets/gallery/meeting/*.{jpg,jpeg,png,webp}", { eager: true })) },
  { category: "Training", files: Object.values(import.meta.glob("/src/assets/gallery/training/*.{jpg,jpeg,png,webp}", { eager: true })) },
];

const categories = images.map((c) => c.category);
---

<section class="py-12">
  <h2 class="text-center text-3xl font-bold mb-16">Gallery</h2>

  <div class="flex flex-wrap justify-center gap-3 mb-8">
    <!-- All button (active default) -->
    <button 
      class="filter-btn px-4 py-2 rounded-lg border border-black bg-black text-white hover:bg-black hover:text-white" 
      data-category="All"
    >
      All
    </button>

    {categories.map((c) => (
      <button 
        class="filter-btn px-4 py-2 rounded-lg border border-black bg-white text-black hover:bg-black hover:text-white" 
        data-category={c}
      >
        {c}
      </button>
    ))}
  </div>

  <div id="gallery-grid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4">
    {images.map((cat) =>
      cat.files.map((img) => (
        <div class="gallery-item overflow-hidden rounded-xl cursor-pointer" data-category={cat.category}>
          <Image src={img.default} alt={cat.category} class="w-full h-60 object-cover hover:scale-110 transition duration-300" />
        </div>
      ))
    )}
  </div>
</section>

<!-- Lightbox HTML -->
<div id="lightbox" class="fixed inset-0 hidden bg-black/80 z-50 justify-center items-center">
  <img id="lightbox-img" class="max-h-[90vh] max-w-[90vw] rounded-xl" />
  <button id="close-lightbox" class="absolute top-6 right-6 bg-white text-black px-3 py-1 rounded-lg font-bold">
    ✕
  </button>
</div>

<script>
  // FILTER
  document.querySelectorAll(".filter-btn").forEach(btn => {
    btn.onclick = () => {
      const cat = btn.dataset.category;

      document.querySelectorAll(".filter-btn").forEach(b => {
        b.classList.remove("bg-black","text-white");
        b.classList.add("bg-white","text-black","border-black");
      });

      btn.classList.remove("bg-white","text-black");
      btn.classList.add("bg-black","text-white");

      document.querySelectorAll(".gallery-item").forEach(item => {
        item.style.display = (cat === "All" || item.dataset.category === cat) ? "" : "none";
      });
    };
  });

  // LIGHTBOX + NEXT / PREV
  const lightbox = document.getElementById("lightbox");
  const lightboxImg = document.getElementById("lightbox-img");
  const images = Array.from(document.querySelectorAll(".gallery-item img"));

  let currentIndex = 0;

  function showImage(index) {
    lightboxImg.src = images[index].src;
  }

  images.forEach((img, index) => {
    img.onclick = () => {
      currentIndex = index;
      showImage(currentIndex);
      lightbox.classList.remove("hidden");
      lightbox.classList.add("flex");
    };
  });

  document.getElementById("close-lightbox").onclick = () => {
    lightbox.classList.add("hidden");
  };

  lightbox.onclick = (e) => {
    if (e.target === lightbox) lightbox.classList.add("hidden");
  };

  // Add Next Previous Buttons
  const nextBtn = document.createElement("button");
  const prevBtn = document.createElement("button");

  nextBtn.innerHTML = "➡️";
  prevBtn.innerHTML = "⬅️";

  nextBtn.className = "absolute right-6 top-1/2 -translate-y-1/2 text-white text-3xl bg-black/30 px-3 py-1 rounded-lg";
  prevBtn.className = "absolute left-6 top-1/2 -translate-y-1/2 text-white text-3xl bg-black/30 px-3 py-1 rounded-lg";

  lightbox.appendChild(nextBtn);
  lightbox.appendChild(prevBtn);

  nextBtn.onclick = (e) => {
    e.stopPropagation();
    currentIndex = (currentIndex + 1) % images.length;
    showImage(currentIndex);
  };

  prevBtn.onclick = (e) => {
    e.stopPropagation();
    currentIndex = (currentIndex - 1 + images.length) % images.length;
    showImage(currentIndex);
  };
</script>

