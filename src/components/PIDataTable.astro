---
import data from '../content/pi-data.json';

// Group by State + Institute
const grouped = data.reduce((acc, row) => {
  const key = `${row.State}__${row.Institute}`;

  if (!acc[key]) {
    acc[key] = {
      State: row.State,
      Institute: row.Institute,
      Members: []
    };
  }

  acc[key].Members.push({
    Name: row.Name,
    Email: row.email
  });

  return acc;
}, {});

// Convert object â†’ array
const groups = Object.values(grouped);
---

<div class="max-w-6xl mx-auto px-6 mt-8 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">

  {groups.map((item) => (
    <div class="bg-white border border-gray-200 rounded-xl shadow-md p-5 hover:shadow-lg transition">

      <div class="space-y-4 text-sm">

        <!-- State -->
        <div>
          <span class="block text-xs font-semibold text-gray-500 uppercase tracking-wide">
            State
          </span>
          <span class="text-gray-800">{item.State}</span>
        </div>

        <!-- Institute -->
        <div>
          <span class="block text-xs font-semibold text-gray-500 uppercase tracking-wide">
            Institute
          </span>
          <span class="text-gray-800">{item.Institute}</span>
        </div>

        <!-- Members List -->
        <div>
          <span class="block text-xs font-semibold text-gray-500 uppercase tracking-wide">
            Members
          </span>

          <ul class="space-y-3">
            {item.Members.map((m) => (
              <li class="border border-gray-200 rounded-lg p-3 bg-gray-50">
                <div class="font-semibold text-gray-900">{m.Name}</div>
                <a href={`mailto:${m.Email}`} class="text-blue-600 underline break-all">
                  {m.Email}
                </a>
              </li>
            ))}
          </ul>
        </div>

      </div>

    </div>
  ))}

</div>
