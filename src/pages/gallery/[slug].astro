---
import Layout from "@layouts/Layout.astro";
import InnerHero from "@components/sections/InnerHero.astro";
import { getCollection } from "astro:content";
import { getAlbumImages } from "../../utils/getAlbumImages";

export async function getStaticPaths() {
  const albums = await getCollection("albums");
  return albums.map((album) => ({
    params: { slug: album.slug ?? album.id },
    props: { album },
  }));
}

const albums = await getCollection("albums");

// current slug
const { slug } = Astro.params;

// sort albums alphabetically (or change logic)
const sorted = albums.sort((a, b) =>
  (a.data.title || "").localeCompare(b.data.title || "")
);

// find index of current album
const index = sorted.findIndex((a) => (a.slug ?? a.id) === slug);

// get prev/next album if exists
const prevAlbum = index > 0 ? sorted[index - 1] : null;
const nextAlbum = index < sorted.length - 1 ? sorted[index + 1] : null;

// album data
const album = Astro.props.album;
const images = getAlbumImages(slug);

const heroContent = {
  title: album.data.title,
  description: "",
};
---

<Layout>
  <InnerHero content={heroContent} />

  <!-- NAVIGATION BUTTONS -->
  <section class="site-container px-4 pt-4 flex justify-between mb-6">
    <!-- Previous -->
    {prevAlbum ? (
      <a
        href={`/gallery/${prevAlbum.slug ?? prevAlbum.id}`}
        class="bg-[var(--color-background-light)] border border-[var(--color-background-dark)] px-4 py-2 rounded-lg shadow hover:shadow-md hover:-translate-y-1 transition-all duration-300 text-[var(--color-primary)]"
      >
        ← Previous
      </a>
    ) : (
      <span></span>
    )}

    <!-- Next -->
    {nextAlbum ? (
      <a
        href={`/gallery/${nextAlbum.slug ?? nextAlbum.id}`}
        class="bg-[var(--color-background-light)] border border-[var(--color-background-dark)] px-4 py-2 rounded-lg shadow hover:shadow-md hover:-translate-y-1 transition-all duration-300 text-[var(--color-primary)]"
      >
        Next →
      </a>
    ) : (
      <span></span>
    )}
  </section>

  <!-- IMAGE GRID -->
  <section class="site-container px-4 pb-base">
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-6">
      {images.map((img) => (
        <a
          href={img.url}
          class="glightbox group block rounded-xl overflow-hidden shadow-md hover:shadow-xl hover:-translate-y-1 transition-all duration-300"
          data-gallery="gallery"
        >
          <div class="relative w-full h-[200px] overflow-hidden rounded-xl">
            <img
              src={img.url}
              alt=""
              class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
            />
            <div class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
          </div>
        </a>
      ))}
    </div>
  </section>

  <script>
    import GLightbox from "glightbox";

    const lightbox = GLightbox({
      selector: ".glightbox",
      touchNavigation: true,
      loop: true,
      zoomable: true,
      draggable: true,
      openEffect: "zoom",
      closeEffect: "zoom",
    });
  </script>
</Layout>
